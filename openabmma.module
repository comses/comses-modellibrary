<?php
// vim:sts=2:sw=2:filetype=php
// $Id$

/**
 * @file
 * 
 * Provides an agent based model archive within the Drupal framework.  This
 * involves the user creation of new model projects, ability to upload new
 * versions of an ABM project and edit associated metadata.  Members of a
 * review committee should also be able to "star" an ABM project to signify
 * its level of maturity and completeness.
 */

include 'admin.php';
include 'drupal.php';
include 'files.php';
include 'misc.php';
include 'model.php';
include 'review.php';
include 'version.php';

function openabmma_showProjects ()
{
  global $user;

  $count = 0;
  $output .= '<br/><b>Your submitted models:</b><hr/><br/>';
  $query = "SELECT m.name, m.title FROM openabm_model m WHERE m.owner_uid=%d";
  $result = db_query ($query, $user->uid);
  while ($node = db_fetch_object ($result))
  {
    $count++;
    $output .= "<b>" . l ($node->title . " (" . $node->name . ")", "mymodels/" . $node->name) . "</b>&nbsp;";

    $output .= "&nbsp;<br/><small>" . $node->description . "<hr/>";
    $output .= "</small><br/>";
  }

  $output .= "You have submitted <b>" . $count . "</b> model(s).<br/>&nbsp;<br/>";
  $count = 0;

  $output .= '<br/><b>You are a member of these models:</b><hr/><br/>';
  $query = "SELECT m.owner_uid, m.name, m.title, B.role 
    FROM openabm_model m INNER JOIN openabm_model_member B ON m.id=B.project_id
    WHERE B.user_id=%d";
  $result = db_query ($query, $user->uid);
  while ($node = db_fetch_object ($result))
  {
    $count++;
    $owner = openabmma_getUserName ($node->owner_uid);
    $output .= "<b>" . l ($node->title . " (" . $node->name . ")", "mymodels/" . $node->name) . "</b>&nbsp;";

    if ($node->visible == 1)	$output .= "[Public]";
    else				$output .= "[Private]";

    $output .= "&nbsp;<br/><small>" . $node->description . "<br/>";
    $output .= "Owned by: <b>" . $owner . "</b></small><hr/><br/>";
  }

  $output .= "You are a member of <b>" . $count . "</b> model(s).<br/>&nbsp;<br/>";
  $output .= "<br/>" . l ("To submit a new model, please click here", "models/add");
  return $output;
}

function openabmma_browseModels ()
{
  $query = "SELECT owner_uid, name, title FROM openabm_model";
  $result = db_query ($query);

  while ($model = db_fetch_object ($result))
  {
    $pId = $model->id;
    $pName = $model->name;
    $pTitle = $model->title;
    $owner_uid = $model->owner_uid;

    $count++;
    $output .= l ($pTitle . " [" . $pName . "]", "mymodels/" . $pName) . "<br/><small>Owner: " . openabmma_getUserName ($owner_uid) . "</small>&nbsp;<br/>";
  }

  if ($count) {
    $output = "<hr/>" . $count . " model(s) available.<br/>&nbsp;<br/>" . $output;
  }
  else {
    $output = "<hr/>No models available.";
  }
  return $output;
}

?>
